# Tools to analyze and visualize tax rates in Switzerland

This project is a collection of tools written in [Rust](https://rust-lang.org/)
to analyze tax rates in Switzerland. As a prerequisite, you need to download tax
rate data, for example using the
[fetch-ch-tax-rates](https://github.com/gendx/fetch-ch-tax-rates) tool.

## Usage

The `analysis/` tool can be compiled and run with the usual
[Rust nightly toolchain](https://rust-lang.org/learn/get-started/), using
`cargo +nightly run --release`. It expects the input tax rate data in the
`data/` folder, relative to the current directory it's run in.

The `wasm/` tool provides a [WebAssembly](https://webassembly.org/) module to
run an interactive visualization in the browser. To compile it, you first need a
Rust nightly toolchain with the `wasm32-unknown-unknown` target, as well as the
[`wasm-pack`](https://github.com/drager/wasm-pack) tool.

```bash
rustup target add --toolchain nightly wasm32-unknown-unknown
cargo install wasm-pack
```

You also need to provide the `data/tables.db` file generated by the `analysis/`
tool. Then, simply build the wasm module.

```bash
wasm-pack build --target web --release --no-typescript --no-pack
```

Lastly, you can call the generated
[module](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules#applying_the_module_to_your_html)
directly from HTML. All you need is to provide a
[canvas element](https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API).

```html
<canvas id="my-canvas" width="730" height="600" />
<script type="module">
import init, { State } from 'wasm_taxes.js'

const canvas = document.getElementById("my-canvas");

async function run() {
    await init();
    const state = new State();

    var year = 2025;
    var zone = "CH";
    var max_salary = 100000;
    var percent = false;
    state.plot(canvas, year, zone, max_salary, percent);
}

run();
</script>
```
